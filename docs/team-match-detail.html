<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Match Detail - SideSpins</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f5f5f5;
        line-height: 1.6;
      }

      .header {
        background: white;
        border-bottom: 1px solid #e1e5e9;
        padding: 1rem 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo {
        font-size: 1.5rem;
        font-weight: bold;
        color: #007cba;
      }

      .nav-links {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .nav-links a {
        color: #666;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        transition: background-color 0.2s;
      }

      .nav-links a:hover {
        background-color: #f0f0f0;
      }

      .main-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .match-header {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .match-teams {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .team-info {
        text-align: center;
        flex: 1;
      }

      .team-name {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 0.5rem;
      }

      .team-score {
        font-size: 2rem;
        font-weight: bold;
        color: #007cba;
      }

      .vs-separator {
        font-size: 1.5rem;
        color: #666;
        margin: 0 1rem;
      }

      .match-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e1e5e9;
      }

      .match-detail-item {
        text-align: center;
      }

      .match-detail-label {
        font-size: 0.875rem;
        color: #666;
        margin-bottom: 0.25rem;
      }

      .match-detail-value {
        font-weight: bold;
        color: #333;
      }

      .player-matches-section {
        background: white;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .section-title {
        font-size: 1.25rem;
        font-weight: bold;
        color: #333;
      }

      .add-match-btn {
        background: #007cba;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        transition: background-color 0.2s;
      }

      .add-match-btn:hover {
        background: #005a87;
      }

      .player-matches-grid {
        display: grid;
        gap: 1rem;
      }

      .player-match-card {
        border: 1px solid #e1e5e9;
        border-radius: 6px;
        padding: 1rem;
        background: #fafafa;
        transition: border-color 0.2s;
      }

      .player-match-card:hover {
        border-color: #007cba;
      }

      .player-match-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }

      .player-names {
        font-weight: bold;
        color: #333;
      }

      .match-status {
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.875rem;
        font-weight: bold;
      }

      .status-pending {
        background: #fef3cd;
        color: #856404;
      }

      .status-in-progress {
        background: #d1ecf1;
        color: #0c5460;
      }

      .status-completed {
        background: #d4edda;
        color: #155724;
      }

      .player-match-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }

      .detail-item {
        text-align: center;
      }

      .detail-label {
        font-size: 0.75rem;
        color: #666;
        margin-bottom: 0.25rem;
      }

      .detail-value {
        font-weight: bold;
        color: #333;
      }

      .match-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: flex-end;
      }

      .action-btn {
        padding: 0.25rem 0.75rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        background: white;
        color: #666;
        text-decoration: none;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
      }

      .action-btn:hover {
        border-color: #007cba;
        color: #007cba;
      }

      .action-btn.primary {
        background: #007cba;
        color: white;
        border-color: #007cba;
      }

      .action-btn.primary:hover {
        background: #005a87;
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: #666;
      }

      .error {
        background: #f8d7da;
        color: #721c24;
        padding: 1rem;
        border-radius: 6px;
        margin-bottom: 1rem;
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: #666;
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      /* Mobile Responsive */
      @media (max-width: 768px) {
        .header-content {
          flex-direction: column;
          gap: 1rem;
        }

        .nav-links {
          flex-wrap: wrap;
          justify-content: center;
        }

        .match-teams {
          flex-direction: column;
          gap: 1rem;
        }

        .vs-separator {
          margin: 0;
        }

        .match-details {
          grid-template-columns: 1fr;
        }

        .player-match-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }

        .player-match-details {
          grid-template-columns: repeat(2, 1fr);
        }

        .match-actions {
          justify-content: flex-start;
          flex-wrap: wrap;
        }
      }

      @media (max-width: 480px) {
        .main-content {
          padding: 1rem 0.5rem;
        }

        .match-header,
        .player-matches-section {
          padding: 1rem;
        }

        .player-match-details {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <div class="logo">SideSpins</div>
        <nav class="nav-links">
          <a href="/">Home</a>
          <a href="/schedule-new.html">Schedule</a>
          <a href="/lineup-explorer-new.html">Lineup Explorer</a>
          <a href="/availability.html">Availability</a>
          <a href="/team-admin.html">Team Admin</a>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <!-- Match Header -->
      <div class="match-header">
        <div class="match-teams">
          <div class="team-info">
            <div class="team-name" id="homeTeamName">Loading...</div>
            <div class="team-score" id="homeTeamScore">-</div>
          </div>
          <div class="vs-separator">vs</div>
          <div class="team-info">
            <div class="team-name" id="awayTeamName">Loading...</div>
            <div class="team-score" id="awayTeamScore">-</div>
          </div>
        </div>

        <div class="match-details">
          <div class="match-detail-item">
            <div class="match-detail-label">Date</div>
            <div class="match-detail-value" id="matchDate">-</div>
          </div>
          <div class="match-detail-item">
            <div class="match-detail-label">Location</div>
            <div class="match-detail-value" id="matchLocation">-</div>
          </div>
          <div class="match-detail-item">
            <div class="match-detail-label">Status</div>
            <div class="match-detail-value" id="matchStatus">-</div>
          </div>
          <div class="match-detail-item">
            <div class="match-detail-label">Division</div>
            <div class="match-detail-value" id="matchDivision">-</div>
          </div>
        </div>
      </div>

      <!-- Alert Container -->
      <div id="alertContainer"></div>

      <!-- Player Matches Section -->
      <div class="player-matches-section">
        <div class="section-header">
          <h2 class="section-title">Player Matches</h2>
          <a href="#" class="add-match-btn" id="addPlayerMatchBtn"
            >+ Add Player Match</a
          >
        </div>

        <div id="playerMatchesContainer">
          <div class="loading">Loading player matches...</div>
        </div>
      </div>
    </main>

    <!-- Load API utilities -->
    <script src="/assets/js/match-api.js"></script>
    <script>
      // Global variables
      let currentTeamMatchId = null;
      let currentDivisionId = null;
      let teamMatchData = null;
      let playerMatches = [];

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Get team match ID from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        currentTeamMatchId = urlParams.get("id");
        currentDivisionId = urlParams.get("divisionId");

        if (!currentTeamMatchId || !currentDivisionId) {
          showError("Missing team match ID or division ID in URL parameters");
          return;
        }

        loadTeamMatchDetail();
        loadPlayerMatches();
      });

      // Load team match details
      async function loadTeamMatchDetail() {
        try {
          loadingManager.show("matchDate", "Loading...");
          teamMatchData = await matchAPI.getTeamMatch(
            currentTeamMatchId,
            currentDivisionId
          );
          displayTeamMatchDetail(teamMatchData);
        } catch (error) {
          console.error("Error loading team match detail:", error);
          alertSystem.showError(
            "Failed to load team match details: " + error.message
          );
        } finally {
          loadingManager.hide("matchDate");
        }
      }

      // Display team match details
      function displayTeamMatchDetail(match) {
        document.getElementById("homeTeamName").textContent =
          match.homeTeamName || "Home Team";
        document.getElementById("awayTeamName").textContent =
          match.awayTeamName || "Away Team";
        document.getElementById("homeTeamScore").textContent =
          match.homeTeamScore || "0";
        document.getElementById("awayTeamScore").textContent =
          match.awayTeamScore || "0";

        document.getElementById("matchDate").textContent = match.matchDate
          ? new Date(match.matchDate).toLocaleDateString()
          : "TBD";
        document.getElementById("matchLocation").textContent =
          match.location || "TBD";
        document.getElementById("matchStatus").textContent =
          match.status || "Pending";
        document.getElementById("matchDivision").textContent =
          match.divisionName || match.divisionId;
      }

      // Load player matches
      async function loadPlayerMatches() {
        try {
          loadingManager.show(
            "playerMatchesContainer",
            "Loading player matches..."
          );
          playerMatches = await matchAPI.getPlayerMatchesByTeamMatch(
            currentTeamMatchId,
            currentDivisionId
          );
          displayPlayerMatches(playerMatches);
        } catch (error) {
          console.error("Error loading player matches:", error);
          const container = document.getElementById("playerMatchesContainer");
          container.innerHTML =
            '<div class="error">Failed to load player matches: ' +
            error.message +
            "</div>";
        } finally {
          loadingManager.hide("playerMatchesContainer");
        }
      }

      // Display player matches
      function displayPlayerMatches(matches) {
        const container = document.getElementById("playerMatchesContainer");

        if (!matches || matches.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">🎱</div>
              <h3>No Player Matches Yet</h3>
              <p>Click "Add Player Match" to create the first player match for this team match.</p>
            </div>
          `;
          return;
        }

        const html = matches
          .map((match) => createPlayerMatchCard(match))
          .join("");
        container.innerHTML = `<div class="player-matches-grid">${html}</div>`;
      }

      // Create player match card HTML
      function createPlayerMatchCard(match) {
        const statusClass = matchUtils.getStatusClass(match.status);

        return `
          <div class="player-match-card">
            <div class="player-match-header">
              <div class="player-names">
                ${match.homePlayerName || "Home Player"} vs ${
          match.awayPlayerName || "Away Player"
        }
              </div>
              <div class="match-status ${statusClass}">
                ${match.status || "Pending"}
              </div>
            </div>
            
            <div class="player-match-details">
              <div class="detail-item">
                <div class="detail-label">Home Score</div>
                <div class="detail-value">${match.homePlayerScore || "0"}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Away Score</div>
                <div class="detail-value">${match.awayPlayerScore || "0"}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Games Played</div>
                <div class="detail-value">${match.gamesPlayed || "0"}</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Duration</div>
                <div class="detail-value">${matchUtils.formatDuration(
                  match.duration
                )}</div>
              </div>
            </div>
            
            <div class="match-actions">
              <a href="player-match-detail.html?id=${
                match.id
              }&divisionId=${currentDivisionId}" class="action-btn">View Details</a>
              <a href="player-match-edit.html?id=${
                match.id
              }&divisionId=${currentDivisionId}" class="action-btn">Edit</a>
              ${
                match.status !== "Completed"
                  ? `<a href="game-recording.html?playerMatchId=${match.id}&divisionId=${currentDivisionId}" class="action-btn primary">Record Games</a>`
                  : ""
              }
            </div>
          </div>
        `;
      }

      // Add player match button handler
      document
        .getElementById("addPlayerMatchBtn")
        .addEventListener("click", function (e) {
          e.preventDefault();
          if (currentTeamMatchId && currentDivisionId) {
            window.location.href = `player-match-create.html?teamMatchId=${currentTeamMatchId}&divisionId=${currentDivisionId}`;
          }
        });
    </script>
  </body>
</html>
